server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: springai-agw
  config:
    import:
      - optional:file:./application-local.yml
      - optional:file:/opt/application.yml
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:dummy-openai-key}

agent:
  catalog:
    external-dir: ${AGENT_EXTERNAL_DIR:agents}
    refresh-interval-ms: ${AGENT_REFRESH_INTERVAL_MS:10000}
  viewport:
    external-dir: ${AGENT_VIEWPORT_EXTERNAL_DIR:viewports}
    refresh-interval-ms: ${AGENT_VIEWPORT_REFRESH_INTERVAL_MS:30000}
  capability:
    tools-external-dir: ${AGENT_TOOLS_EXTERNAL_DIR:tools}
    refresh-interval-ms: ${AGENT_CAPABILITY_REFRESH_INTERVAL_MS:30000}
  skill:
    external-dir: ${AGENT_SKILL_EXTERNAL_DIR:skills}
    refresh-interval-ms: ${AGENT_SKILL_REFRESH_INTERVAL_MS:30000}
    max-prompt-chars: ${AGENT_SKILL_MAX_PROMPT_CHARS:8000}
  llm:
    interaction-log:
      enabled: ${AGENT_LLM_INTERACTION_LOG_ENABLED:true}
      mask-sensitive: ${AGENT_LLM_INTERACTION_LOG_MASK_SENSITIVE:true}
  tools:
    frontend:
      submit-timeout-ms: ${AGENT_TOOLS_FRONTEND_SUBMIT_TIMEOUT_MS:300000}
    agent-file-create:
      default-system-prompt: ${AGENT_TOOLS_AGENT_FILE_CREATE_DEFAULT_SYSTEM_PROMPT:你是通用助理，回答要清晰和可执行。}
    bash:
      working-directory: ${AGENT_BASH_WORKING_DIRECTORY:${user.dir}}
      allowed-paths: ${AGENT_BASH_ALLOWED_PATHS:}

memory:
  chat:
    dir: ${MEMORY_CHAT_DIR:./chats}
    k: ${MEMORY_CHAT_K:20}
    charset: ${MEMORY_CHAT_CHARSET:UTF-8}
    action-tools: ${MEMORY_CHAT_ACTION_TOOLS:}

agw:
  auth:
    enabled: ${AGW_AUTH_ENABLED:true}
    jwks-uri: ${AGW_AUTH_JWKS_URI:http://127.0.0.1:38080/api/auth/jwks}
    issuer: ${AGW_AUTH_ISSUER:http://127.0.0.1:38080}
    jwks-cache-seconds: ${AGW_AUTH_JWKS_CACHE_SECONDS:300}
    local-public-key-enabled: ${AGW_AUTH_LOCAL_PUBLIC_KEY_ENABLED:false}
    local-public-key: ${AGW_AUTH_LOCAL_PUBLIC_KEY:}
    # Example local key in PEM format:
    # local-public-key-enabled: true
    # local-public-key: |
    #   -----BEGIN PUBLIC KEY-----
    #   MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtesttesttesttesttest
    #   testtesttesttesttesttesttesttesttesttesttesttesttesttesttesttest
    #   testtesttesttesttesttesttesttesttesttesttesttesttesttesttesttest
    #   -----END PUBLIC KEY-----
  chat-event-callback:
    enabled: ${AGW_CHAT_EVENT_CALLBACK_ENABLED:true}
    url: ${AGW_CHAT_EVENT_CALLBACK_URL:http://127.0.0.1:38080/api/app/internal/chat-events}
    secret: ${AGW_CHAT_EVENT_CALLBACK_SECRET:change-me}
    connect-timeout-ms: ${AGW_CHAT_EVENT_CALLBACK_CONNECT_TIMEOUT_MS:1000}
    request-timeout-ms: ${AGW_CHAT_EVENT_CALLBACK_REQUEST_TIMEOUT_MS:1500}

logging:
  level:
    root: INFO
    com.linlay.springaiagw: INFO
    com.linlay.springaiagw.service.LlmService: DEBUG
    com.linlay.springaiagw.service.OpenAiCompatibleSseClient: DEBUG
    com.linlay.springaiagw.service.LlmCallLogger: DEBUG
    com.linlay.springaiagw.llm.wiretap: DEBUG
